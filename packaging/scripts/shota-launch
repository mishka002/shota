#!/usr/bin/env bash
set -euo pipefail

APP_DIR="/opt/shota"
VENV_DIR="$APP_DIR/.venv"

PYTHON_BIN="python3"
if command -v python3 >/dev/null 2>&1; then
  PYTHON_BIN="python3"
elif command -v python >/dev/null 2>&1; then
  PYTHON_BIN="python"
fi

if [ ! -d "$VENV_DIR" ]; then
  "$PYTHON_BIN" -m venv "$VENV_DIR"
fi

"$VENV_DIR/bin/python" -m pip install --upgrade pip >/dev/null 2>&1 || true
if [ -f "$APP_DIR/requirements.txt" ]; then
  "$VENV_DIR/bin/pip" install -r "$APP_DIR/requirements.txt" >/dev/null 2>&1 || true
fi

exec "$VENV_DIR/bin/python" "$APP_DIR/lancher.py"